<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard 2</title>
    <style>
        /* Genel düzen */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #container {
            position: absolute;
    height: 100vh;
    width: 75%;
    right: 0px;
        }

        /* Sol menü */
        #sidebar {
            width: 90%;
    background-color: white;
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
}

#sidebar a {
    color: #2c3e50;
    text-decoration: none;
    margin: 15px 0;
    font-size: 1.2rem;
    padding: 10px 15px;
    border-radius: 5px;
    width: 100%;
    transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
}
#sidebar a.active {
    background-color: #007bff;
    color: white;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    font-weight: bold; /* Aktif sayfanın yazı kalınlığını artır */
}

#sidebar a:hover {
    background-color: #007bff;
    color: white;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    border-radius: 5px;
}


        /* Sağ içerik alanı */
        #content {
           
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        #select-container {
            display: flex;
    width: 100%;
    /* text-align: center; */
    margin-bottom: 20px;
    flex-direction: row;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-around;
    
}

        #select-container select {
            width: 100%;
            padding: 10px;
            font-size: 1.2rem;
        }

        /* Alt taraftaki içerik alanı (daha sonra doldurulacak) */
        #empty-container {
            width: 100%;
            height: 400px; /* Yükseklik büyük olsun dedin */
            background-color: #5ce1e6;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 1.5rem;
        }

        /* Genel Logo Düzeni */
#logo {
    display: flex;
    align-items: center;
    padding-bottom: 20px; /* Alt tarafa biraz boşluk ekledik */
}

/* Logo Resmi */
.logoImage img {
    width: 60px; /* Logonun genişliği */
    margin-right: 10px; /* Resmin sağında biraz boşluk */
}


.productRow :hover{
    cursor: pointer;
    background-color: #ccc;
}

/* Logonun Sağındaki Metinler */
#logoBigText {
    border-left: 2px solid blue; /* Sol tarafa mavi bir çizgi ekledik */
    padding-left: 10px; /* Çizgi ile metin arasına boşluk */
    display: flex;
    flex-direction: column;
}

#logoText {
    font-size: 1.8rem; /* Üstteki büyük yazı */
    color: blue; /* Yazı rengi mavi */
}

#logoTextUnder {
    font-size: 0.9rem; /* Altındaki küçük yazı */
    color: red; /* Yazı rengi kırmızı */
}
.selectButton{
    background-color: #5ce1e6; /* Butonun arka plan rengi */
    border: none; /* Kenarlık yok */
    color: black; /* Yazı rengi siyah */
    padding: 10px 20px; /* İç boşluklar */
    text-align: center; /* Yazıyı ortala */
    text-decoration: none; /* Alt çizgiyi kaldır */
    display: inline-block; /* Buton olarak görünmesini sağlar */
    font-size: 1rem; /* Yazı boyutu */
    border-radius: 25px; /* Köşeleri yuvarlat */
    cursor: pointer; /* Fare imlecini işaretçiye çevirir */
    font-family: Arial, sans-serif; /* Yazı tipi */
    transition: background-color 0.5s ease; /* Geçiş süresi ve yumuşaklık ayarı */
}
.selectButton:hover{
    background-color: #4bc0c5; /* Üzerine gelince renk değişimi */
    transition: background-color 0.5s ease; /* Geçiş süresi ve yumuşaklık ayarı */
    
}

/* Tablo konteynerini sınırlandır ve overflow ekle */
#table-container {
    max-width: 100%;
    max-height: 55vh; /* Tabloya belirli bir yükseklik veriyoruz */
    overflow-y: auto; /* Yatay scroll ekliyoruz */
    border: 1px solid #ccc; /* Dış sınırlar */
}

/* Tablo düzeni */
#part-details-table {
    width: 90%;
    border-collapse: separate; /* Hücrelerin birleşmesini engeller */
    border-spacing: 3px; /* Hücreler arası boşluk */
    
}

/* Sabit kalan başlıklar */
#part-details-table thead th {
    background-color: #d9d9d9 !important;
    position: sticky;
    top: 0;
    margin: 5px;
    z-index: 2;
    text-align: left;
    padding: 10px;
    /* border-bottom: 2px solid #ddd; */
    font-weight: bold;
}

/* Satır düzeni */
#part-details-table tbody td {
    
    /* background-color: #fffffd; */
    padding: 10px;
    /* border-bottom: 1px solid #ddd; */
    text-align: left;
}

/* Tabloya arka plan ve genel stil */
/* #part-details-table tbody tr:nth-child(even) {
    background-color: #f2f2f2;
} */

/* Scroll edilen tablo için sütunların genişliğini belirle */
#part-details-table th, #part-details-table td {
    min-width: 150px; /* Kolonların minimum genişliği */
}


.details-content {
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    flex-direction: row;
    flex-wrap: wrap;
}

.api-column {
    text-align: center;
    width: 18%; /* Her sütunun genişliği */
    padding: 10px;
}

.api-logo {
    width: 100px; /* Logonun genişliği */
    height: auto; /* Yükseklik otomatik */
    margin-bottom: 10px;
}

.api-column p {
    margin: 5px 0;
}
.rightBigDiv{
    padding-top: 5vh;
}
.uContent{
    height: 80%;
    background-color: #5ce2e7;
}
.theadClass{
    background-color: #d9d9d9 !important;

}
thead.theadClass tr {
    border-bottom: 5px solid transparent; /* Altta 5px boşluk görünümü için */
}

.icon-cell  {
    background-color:#5ce2e7 !important; /* Arka planı şeffaf yapar */
    
}
tr.productRow{
    background-color: #fffffd;
}
tr.productRow:hover {
    background-color: #c7baba; /* Hover sırasında arka plan rengi */
    cursor: pointer; /* İmleci işaretçi şeklinde değiştir */
}

.openDiv {
    background-color: aliceblue; /* Arka plan rengi */
    
}
/* formTotal için CSS */
.formTotal {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    padding: 0px 2vh;
    background-color: #f4f4f4; /* Hafif bir arka plan rengi */
    border-radius: 8px; /* Hafif köşe yuvarlama */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Hafif gölge */
    margin: 10px 5vh; /* Üst ve alt boşluk */
}

/* Label ve input stil düzenlemeleri */
.formTotal label {
    font-size: 1.2rem;
    margin-right: 10px;
    color: #333; /* Koyu gri yazı rengi */
}

.formTotal input[type="number"] {
    padding: 10px;
    font-size: 1.2rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 100px;
}

/* Toplam fiyat için stil */
.formTotal p {
    font-size: 1.2rem;
    color: #333;
    margin-left: 20px;
}



#bom-count-container{
    width: 50%;
}
#bom-form{
width: 50vh;
margin-bottom: 1vh;
}
.mailButtons{
    width: 20%;
    display: flex;
    justify-content: space-between;
    flex-direction: column;
}
.navbarButtons {
    background-color: #4CAF50; /* Butonun arka plan rengi */
    border: none; /* Kenarlık yok */
    color: white; /* Yazı rengi beyaz */
    padding: 6px 14px; /* Butonun iç boşlukları */
    text-align: center; /* Yazıyı ortala */
    text-decoration: none; /* Alt çizgi yok */
    display: inline-block; /* Butonu satır içi blok eleman yap */
    font-size: 13px; /* Yazı boyutu */
    font-weight: bold; /* Yazı kalınlığı */
    border-radius: 5px; /* Hafif yuvarlak köşeler */
    transition: background-color 0.3s ease, box-shadow 0.3s ease; /* Hover geçiş animasyonu */
    cursor: pointer; /* Butona işaretçi imleci ekle */
}

.navbarButtons:hover {
    background-color: #45a049; /* Hover durumunda arka plan rengi */
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); /* Hover durumunda hafif gölge */
}

.navbarButtons:active {
    background-color: #3e8e41; /* Tıklama durumunda arka plan rengi */
    box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2); /* Tıklama durumunda gölge */
    transform: translateY(2px); /* Tıklama sırasında buton hafif aşağı iner */
}


#unavailable-products {
    background-color: #ffe6e6;
    border: 2px solid red;
    padding: 15px;
    border-radius: 10px;
}

#unavailable-products ul {
    list-style-type: none;
    padding: 0;
}

#unavailable-products li {
    margin-bottom: 10px;
    font-size: 1.1rem;
}
.missing-product-row{
    background-color: #ffefef; /* Hafif kırmızı arka plan */
    color: #d9534f; /* Koyu kırmızı yazı */
    font-weight: bold; /* Kalın yazı */
}
.missing-product-row td {
    border-bottom: 2px solid #d9534f; /* Kırmızı alt çizgi */
    padding: 10px;
}
.buttonsDiv{
    width: 50vh;
    display: flex;
    flex-wrap: nowrap;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
}
    </style>
</head>
<body>
    <%- include('partials/leftSide') %>
    <div id="container">
        
        
         <div class="rightBigDiv">
           <!-- Select Option Alanı -->
           <div id="select-container">
            
            <% if (! selectedFileId) { %>
                <form id="bom-form" action="/dashboard2" method="GET" sty>
                    <select name="fileId" id="bom-selector" onchange="this.form.submit()">
                        <option value="">Bir BOM dosyası seçin</option>
                        <% bomFiles.forEach(function(bom) { %>
                            <option value="<%= bom.id %>" <%= bom.id == selectedFileId ? 'selected' : '' %> >
                                <%= bom.file_name %>
                            </option>
                        <% }) %>
                    </select>
                    
                </form>
            <% } %>


            <% if (selectedFileId) { %>
                <div class="mailButtons">
                    <form id="bom-form" action="/dashboard2" method="GET" sty>
                        <select name="fileId" id="bom-selector" onchange="this.form.submit()">
                            <option value="">Bir BOM dosyası seçin</option>
                            <% bomFiles.forEach(function(bom) { %>
                                <option value="<%= bom.id %>" <%= bom.id == selectedFileId ? 'selected' : '' %> >
                                    <%= bom.file_name %>
                                </option>
                            <% }) %>
                        </select>
                        
                    </form>
                    <div class="buttonsDiv">
                    <form id="sendBomEmailForm" method="POST" action="/send-bom-email">
                        <!-- Gizli alanlar, bomDetails, totalPrice ve maxLeadTime verilerini POST isteği ile göndermek için -->
                        <input type="hidden" name="bomDetails" value='<%= JSON.stringify(bomDetails) %>'>
                        <input type="hidden" name="totalPrice" value="<%= totalPrice %>">
                        <input type="hidden" name="maxLeadTime" value="<%= maxLeadTime %>">
                    
                        <button type="submit" class="btn btn-primary navbarButtons">Mail Gönder</button>
                    </form>
                    
                    <button class="navbarButtons">Bilgisayara Kaydet</button>
                </div>
                </div>
            <div id="bom-count-container" >
                <form id="bom-count-form" action="/saveBomCount" method="POST" class="formTotal">
                    <!-- BOM ID'sini gizli bir inputla POST ediyoruz -->
                   
                
                    <!-- BOM Adedi Girişi -->
                    <div>
                        <label for="bomCount">BOM Adedi:</label>
                        <input type="number" id="bomCount" name="bomCount" min="1" value="<%= bomCount || 1 %>" required>
                    </div>
                
                    <!-- Toplam Fiyat Bilgisi -->
                    <p>Toplam Fiyat: $<%= totalPrice %></p>
                    <div>
                        <h4>En Yakın Teslimat Bitiş Süresi: <%= maxLeadTime %> gün</h4>
                    </div>
                    
                    <input type="hidden" name="totalPrice" value="<%= totalPrice %>">
                    <input type="hidden" name="fileId" value="<%= selectedFileId %>"> <!-- BOM dosyasının ID'si -->
                    <!-- Güncelle Butonu -->
                    <button type="submit" class="navbarButtons">Güncelle</button>
                </form>
                
            </div>
            


            <% } %>
        </div>

        <div class="uContent">

        <!-- Sağ İçerik Alanı -->
        <div id="content">
          
        
            <!-- Tablo Alanı -->
            <div id="table-container">
                <table id="part-details-table">
                    <thead class="theadClass">
                        <tr>
                            <th>Üretici Parça Numarası</th>
                            <th>Üretici</th>
                            <th>Adet</th>
                            <th>Stok</th>
                            <th>Birim Fiyat</th>
                            <th>Toplam</th>
                            <th>Önerilen Tedarikçi</th>
                            <th>Detaylar</th>
                        </tr>
                    </thead>
                    <tbody id="part-details-body">
                        <% if (bomDetails && bomDetails.length > 0) { %>
                            <% bomDetails.forEach(function(detail, index) { %>
                
                                <% 
                                // Üretim dışı kontrolü DigiKey ve Mouser'da yapılır
                                const isDiscontinued = detail.digikey?.isDiscontinued || detail.mouser?.isDiscontinued;
                                %>
                
                                <% if (isDiscontinued) { %>
                                    <!-- Üretim dışı ürünler kırmızı renkte -->
                                    <tr style="background-color: #ffcccc;">
                                        <td><%= detail.partNumber %> - Üretim Dışı</td>
                                        <td colspan="7">Bu ürün artık üretimde değil.</td>
                                    </tr>
                                <% } else if (detail.recommendedSupplier) { %>
                                    <!-- Ana satır -->
                                    <tr class="productRow" data-index="<%= index %>" data-part-number="<%= detail.selectedResult.partNumber %>">
                                        <td><%= detail.selectedResult.partNumber %></td>
                                        <td><%= detail.selectedResult.manufacturer || 'Bilinmiyor' %></td>
                                        <td><%= detail.selectedResult.quantity || 'Bilinmiyor' %></td>
                                        <td><%= detail.selectedResult.stock || 'N/A' %></td>
                                        <td>$<%= detail.selectedResult.unitPrice || 'N/A' %></td>
                                        <td>$<%= detail.selectedResult.totalPrice || 'N/A' %></td>
                                        <td><%= detail.recommendedSupplier || 'N/A' %></td>
                                        <td class="icon-cell"><i class="fa-solid fa-angle-left"></i></td> <!-- İkon hücresi -->
                                    </tr>
                
                                    <!-- Details satırı -->
                                    <tr id="details-<%= detail.selectedResult.partNumber %>" style="display: none;">
                                        <td colspan="8">
                                            <div class="details-content" id="detail-container-<%= detail.selectedResult.partNumber %>">
                                                <!-- DigiKey Bilgileri -->
                                                <div class="api-column">
                                                    <img src="/images/digikey.png" alt="DigiKey" class="api-logo">
                                                    <p>Parça Numarası: <%= detail.digikey.partNumber %></p>
                                                    <p>Üretici: <%= detail.digikey.manufacturer %></p>
                                                    <p>Stok: <%= detail.digikey.stock %></p>
                                                    <p>Fiyat: $<%= detail.digikey.unitPrice %></p>
                                                    <p>Toplam Fiyat: $<%= detail.digikey.totalPrice %></p>
                                                    <p>Lead Time: <%= detail.digikey.leadTime %> gün</p>
                                                    <p>Tedarikçi: DigiKey</p>
                                                    <% if (detail.digikey.isDiscontinued) { %>
                                                        <p style="color: red;">Bu ürün DigiKey'de üretim dışıdır.</p>
                                                    <% } %>
                                                </div>
                
                                                <!-- Mouser Bilgileri -->
                                                <div class="api-column">
                                                    <img src="/images/mouser.jpg" alt="Mouser" class="api-logo">
                                                    <p>Parça Numarası: <%= detail.mouser.partNumber %></p>
                                                    <p>Üretici: <%= detail.mouser.manufacturer %></p>
                                                    <p>Stok: <%= detail.mouser.stock %></p>
                                                    <p>Fiyat: <%= detail.mouser.unitPrice %></p>
                                                    <p>Toplam Fiyat: $<%= detail.mouser.totalPrice %></p>
                                                    <p>Lead Time: <%= detail.mouser.leadTime %> gün</p>
                                                    <p>Tedarikçi: Mouser</p>
                                                    <% if (detail.mouser.isDiscontinued) { %>
                                                        <p style="color: red;">Bu ürün Mouser'da üretim dışıdır.</p>
                                                    <% } %>
                                                </div>
                
                                                <!-- Avnet Bilgileri -->
                                                <div class="api-column">
                                                    <img src="/images/Avnet.png" alt="Avnet" class="api-logo">
                                                    <p>Parça Numarası: <%= detail.avnet?.partNumber || 'N/A' %></p>
                                                    <p>Üretici: <%= detail.avnet?.manufacturer || 'N/A' %></p>
                                                    <p>Stok: <%= detail.avnet?.stock || 'N/A' %></p>
                                                    <p>Fiyat: <%= detail.avnet?.unitPrice || 'N/A' %></p>
                                                    <p>Toplam Fiyat: $<%= detail.avnet?.totalPrice || 'N/A' %></p>
                                                    <p>Lead Time: <%= detail.avnet?.leadTime || 'N/A' %> gün</p>
                                                    <p>Tedarikçi: Avnet</p>
                                                </div>
                
                                                <!-- Future Bilgileri -->
                                                <div class="api-column">
                                                    <img src="/images/future.jpeg" alt="Future" class="api-logo">
                                                    <p>Parça Numarası: <%= detail.future?.partNumber || 'N/A' %></p>
                                                    <p>Üretici: <%= detail.future?.manufacturer || 'N/A' %></p>
                                                    <p>Stok: <%= detail.future?.stock || 'N/A' %></p>
                                                    <p>Fiyat: <%= detail.future?.unitPrice || 'N/A' %></p>
                                                    <p>Toplam Fiyat: $<%= detail.future?.totalPrice || 'N/A' %></p>
                                                    <p>Lead Time: <%= detail.future?.leadTime || 'N/A' %> gün</p>
                                                    <p>Tedarikçi: Future</p>
                                                </div>
                
                                                <!-- Utmel Bilgileri -->
                                                <div class="api-column">
                                                    <img src="/images/utmel.png" alt="Utmel" class="api-logo">
                                                    <p>Parça Numarası: <%= detail.utmel?.partNumber || 'N/A' %></p>
                                                    <p>Üretici: <%= detail.utmel?.manufacturer || 'N/A' %></p>
                                                    <p>Stok: <%= detail.utmel?.stock || 'N/A' %></p>
                                                    <p>Fiyat: <%= detail.utmel?.unitPrice || 'N/A' %></p>
                                                    <p>Toplam Fiyat: $<%= detail.utmel?.totalPrice || 'N/A' %></p>
                                                    <p>Lead Time: <%= detail.utmel?.leadTime || 'N/A' %> gün</p>
                                                    <p>Tedarikçi: Utmel</p>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                <% } else if (!detail.recommendedSupplier && !isDiscontinued) { %>
                                    <!-- Bilgi alınamayan ürünleri uygun şekilde listele -->
                                    <tr class="missing-product-row">
                                        <td colspan="8"><%= detail.partNumber %> - Bilgi Alınamayan Ürün</td>
                                    </tr>
                                <% } %>
                            <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="8">Bu dosya için veri bulunamadı.</td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
                
            </div>
            
            
            
        </div>

       

    </div>
    </div>
    </div>



</body>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const productRows = document.querySelectorAll('.productRow');
    let openPartNumber = null;

    productRows.forEach((row) => {
        row.addEventListener('click', function () {
            const partNumber = row.getAttribute('data-part-number');
            const detailsRow = document.getElementById(`details-${partNumber}`);
            const iconCell = row.querySelector('.icon-cell i'); // İkonu bul

            // Diğer açık satır varsa kapat ve openDiv sınıfını kaldır
            if (openPartNumber !== null && openPartNumber !== partNumber) {
                const openRow = document.getElementById(`details-${openPartNumber}`);
                const openIcon = document.querySelector(`[data-part-number="${openPartNumber}"] .icon-cell i`); // Açık olan satırın ikonunu bul

                if (openRow) {
                    openRow.style.display = 'none';
                    openRow.classList.remove('openDiv'); // openDiv sınıfını kaldır

                    // Açık olan satırın ikonunu geri sola ok yap
                    if (openIcon) {
                        openIcon.classList.remove('fa-angle-down');
                        openIcon.classList.add('fa-angle-left');
                    }
                }
            }

            // Eğer tıklanan satır açıksa kapat ve openDiv sınıfını kaldır, değilse aç ve openDiv sınıfını ekle
            if (detailsRow.style.display === 'none' || detailsRow.style.display === '') {
                detailsRow.style.display = 'table-row';
                detailsRow.classList.add('openDiv'); // openDiv sınıfını ekle
                openPartNumber = partNumber;

                // İkonu aşağı ok yap
                if (iconCell) {
                    iconCell.classList.remove('fa-angle-left');
                    iconCell.classList.add('fa-angle-down');
                }
            } else {
                detailsRow.style.display = 'none';
                detailsRow.classList.remove('openDiv'); // openDiv sınıfını kaldır
                openPartNumber = null;

                // İkonu tekrar sola ok yap
                if (iconCell) {
                    iconCell.classList.remove('fa-angle-down');
                    iconCell.classList.add('fa-angle-left');
                }
            }

            // Tıklanan part numarasını loglayalım
            console.log(`Tıklanan Part Number: ${partNumber}`);
        });
    });
});





    document.getElementById('bom-selector').addEventListener('change', function() {
        const fileId = this.value;
        if (fileId) {
            window.location.href = `/dashboard2/${fileId}`; // Seçilen BOM dosyasına göre sayfayı yönlendiriyoruz
        }
    });

    document.getElementsByClassName('productRow').addEventListener('click',function(){
        console.log("row a tıkladı");

        // productRow sınıfına sahip her bir elemana tıklama olayını ekle
const productRows = document.getElementsByClassName('productRow');
let openIndex = null;  // Şu anda hangi satırın açık olduğunu takip etmek için

// HTMLCollection olan productRows'u array'e çevirip foreach ile döngü kuralım
Array.from(productRows).forEach((row, index) => {
    row.addEventListener('click', function () {
        const partNumber = row.getAttribute('data-part-number');
        const detailsRow = document.getElementById(`details-${index}`);

        // Eğer başka bir satır açık ise onu kapat
        if (openIndex !== null && openIndex !== index) {
            document.getElementById(`details-${openIndex}`).style.display = 'none';
        }

        // Eğer detay satırı kapalıysa aç ve içeriği doldur
        if (detailsRow.style.display === 'none' || detailsRow.style.display === '') {
            detailsRow.innerHTML = `
                <td colspan="7">
                    <div class="details-content">
                        <div class="api-column">
                            <img src="/images/digikey-logo.png" alt="DigiKey" class="api-logo">
                            <p>Parça Numarası: ${partNumber}</p>
                            <p>Stok: 100</p>
                            <p>Fiyat: $10.00</p>
                            <p><a href="#">Detaylar</a></p>
                        </div>
                        <div class="api-column">
                            <img src="/images/mouser-logo.png" alt="Mouser" class="api-logo">
                            <p>Parça Numarası: ${partNumber}</p>
                            <p>Stok: 50</p>
                            <p>Fiyat: $15.00</p>
                            <p><a href="#">Detaylar</a></p>
                        </div>
                        <!-- Diğer API'ler için sütunlar ekleyebilirsin -->
                    </div>
                </td>
            `;
            detailsRow.style.display = 'table-row';  // Detay satırını göster
            openIndex = index;  // Açık olan satırı güncelle
        } else {
            detailsRow.style.display = 'none';  // Eğer zaten açık ise kapat
            openIndex = null;
        }
    });
});



    });
    

function populatePartDetails(data) {
    const container = document.getElementById('part-details-body');
    container.innerHTML = ''; // Temizle

    if (data.partDetails && data.partDetails.length > 0) {
        data.partDetails.forEach((detail, index) => {
            const row = document.createElement('tr');
            row.classList.add('part-row');  // Satırları part-row sınıfıyla işaretle
            row.setAttribute('data-part-number', detail.partNumber);  // Part numarasını veri olarak ekliyoruz
            row.setAttribute('data-index', index);  // Index bilgisini ekliyoruz

            row.innerHTML = `
                <td>${detail.partNumber}</td>
                <td>${detail.manufacturer || 'Bilinmiyor'}</td>
                <td>${detail.quantity || 'Bilinmiyor'}</td>
                <td>${detail.stock || 'N/A'}</td>
                <td>$${detail.unitPrice || 'N/A'}</td>
                <td>$${detail.totalPrice || 'N/A'}</td>
                <td>${detail.recommendedSupplier || 'N/A'}</td>
            `;

            // Detay satırı
            const detailsRow = document.createElement('tr');
            detailsRow.id = `details-${index}`;
            detailsRow.style.display = 'none'; // Başlangıçta gizli olacak
            detailsRow.innerHTML = `<td colspan="7"></td>`;  // Detaylar buraya eklenecek

            container.appendChild(row);
            container.appendChild(detailsRow);  // Detay satırını ekliyoruz
        });

        addRowClickListeners(); // Satır tıklama olaylarını ekle
    } else {
        container.innerHTML = '<tr><td colspan="7">Bu dosya için part numarası bulunamadı.</td></tr>';
    }
}

    function addRowClickListeners() {
        console.log("addRowClickListeners a girdi");
    const partRows = document.querySelectorAll('.part-row');
    let openIndex = null;

    partRows.forEach(row => {
        row.addEventListener('click', async function () {
            console.log("Satıra tıklandı: ", this.getAttribute('data-part-number'));
            const partNumber = this.getAttribute('data-part-number');
            const index = this.getAttribute('data-index');
            const detailsRow = document.getElementById(`details-${index}`);

            if (openIndex !== null && openIndex !== index) {
                document.getElementById(`details-${openIndex}`).style.display = 'none';  // Önceki açık satırı kapat
            }

            if (detailsRow.style.display === 'none' || detailsRow.style.display === '') {
                const digikeyData = await fetch(`/api/digikey/${partNumber}`).then(res => res.json());
                const mouserData = await fetch(`/api/mouser/${partNumber}`).then(res => res.json());

                const api3Data = { partNumber: partNumber, stock: "N/A", unitPrice: "N/A", productUrl: "#" };
                const api4Data = { partNumber: partNumber, stock: "N/A", unitPrice: "N/A", productUrl: "#" };
                const api5Data = { partNumber: partNumber, stock: "N/A", unitPrice: "N/A", productUrl: "#" };

                detailsRow.innerHTML = `
                    <td colspan="7">
                        <div class="details-content">
                            <div class="api-column">
                                <img src="/images/digikey-logo.png" alt="DigiKey" class="api-logo">
                                <p>Parça Numarası: ${digikeyData.partNumber}</p>
                                <p>Stok: ${digikeyData.stock}</p>
                                <p>Fiyat: ${digikeyData.unitPrice}</p>
                                <p><a href="${digikeyData.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                            <div class="api-column">
                                <img src="/images/mouser-logo.png" alt="Mouser" class="api-logo">
                                <p>Parça Numarası: ${mouserData.partNumber}</p>
                                <p>Stok: ${mouserData.stock}</p>
                                <p>Fiyat: ${mouserData.unitPrice}</p>
                                <p><a href="${mouserData.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                            <div class="api-column">
                                <img src="/images/api3-logo.png" alt="API 3" class="api-logo">
                                <p>Parça Numarası: ${api3Data.partNumber}</p>
                                <p>Stok: ${api3Data.stock}</p>
                                <p>Fiyat: ${api3Data.unitPrice}</p>
                                <p><a href="${api3Data.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                            <div class="api-column">
                                <img src="/images/api4-logo.png" alt="API 4" class="api-logo">
                                <p>Parça Numarası: ${api4Data.partNumber}</p>
                                <p>Stok: ${api4Data.stock}</p>
                                <p>Fiyat: ${api4Data.unitPrice}</p>
                                <p><a href="${api4Data.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                            <div class="api-column">
                                <img src="/images/api5-logo.png" alt="API 5" class="api-logo">
                                <p>Parça Numarası: ${api5Data.partNumber}</p>
                                <p>Stok: ${api5Data.stock}</p>
                                <p>Fiyat: ${api5Data.unitPrice}</p>
                                <p><a href="${api5Data.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                        </div>
                    </td>
                `;

                detailsRow.style.display = 'table-row';
                openIndex = index;
            } else {
                detailsRow.style.display = 'none';
                openIndex = null;
            }
        });
    });
}

</script>

<script src="https://kit.fontawesome.com/d497048b92.js" crossorigin="anonymous"></script>
</html>
