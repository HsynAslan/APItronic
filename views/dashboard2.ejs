<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard 2</title>
    <style>
        /* Genel düzen */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #container {
            display: flex;
            height: 100vh; /* Tam ekran boyutunda olacak */
        }

        /* Sol menü */
        #sidebar {
    width: 90%;
    background-color: white; /* Arka plan rengini beyaz yaptık */
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1); /* Hafif bir gölge eklendi */
}

#sidebar a {
    color: #2c3e50;
    text-decoration: none;
    margin: 15px 0;
    font-size: 1.2rem;
    transition: box-shadow 0.3s ease; /* Hover efektini daha akıcı yap */
}

/* Hover durumunda gölge efekti */
#sidebar a:hover {
    box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2); /* Hafif bir gölge */
    border-radius: 5px; /* Hafif köşe yuvarlatma */
}

        /* Sağ içerik alanı */
        #content {
            width: 80%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        #select-container {
    display: flex;
    width: 100%;
    /* text-align: center; */
    margin-bottom: 20px;
    flex-direction: row;
    flex-wrap: wrap;
    align-items: center;
    
}

        #select-container select {
            width: 60%;
            padding: 10px;
            font-size: 1.2rem;
        }

        /* Alt taraftaki içerik alanı (daha sonra doldurulacak) */
        #empty-container {
            width: 100%;
            height: 400px; /* Yükseklik büyük olsun dedin */
            background-color: #5ce1e6;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 1.5rem;
        }

        /* Genel Logo Düzeni */
#logo {
    display: flex;
    align-items: center;
    padding-bottom: 20px; /* Alt tarafa biraz boşluk ekledik */
}

/* Logo Resmi */
.logoImage img {
    width: 60px; /* Logonun genişliği */
    margin-right: 10px; /* Resmin sağında biraz boşluk */
}

/* Logonun Sağındaki Metinler */
#logoBigText {
    border-left: 2px solid blue; /* Sol tarafa mavi bir çizgi ekledik */
    padding-left: 10px; /* Çizgi ile metin arasına boşluk */
    display: flex;
    flex-direction: column;
}

#logoText {
    font-size: 1.8rem; /* Üstteki büyük yazı */
    color: blue; /* Yazı rengi mavi */
}

#logoTextUnder {
    font-size: 0.9rem; /* Altındaki küçük yazı */
    color: red; /* Yazı rengi kırmızı */
}
.selectButton{
    background-color: #5ce1e6; /* Butonun arka plan rengi */
    border: none; /* Kenarlık yok */
    color: black; /* Yazı rengi siyah */
    padding: 10px 20px; /* İç boşluklar */
    text-align: center; /* Yazıyı ortala */
    text-decoration: none; /* Alt çizgiyi kaldır */
    display: inline-block; /* Buton olarak görünmesini sağlar */
    font-size: 1rem; /* Yazı boyutu */
    border-radius: 25px; /* Köşeleri yuvarlat */
    cursor: pointer; /* Fare imlecini işaretçiye çevirir */
    font-family: Arial, sans-serif; /* Yazı tipi */
    transition: background-color 0.5s ease; /* Geçiş süresi ve yumuşaklık ayarı */
}
.selectButton:hover{
    background-color: #4bc0c5; /* Üzerine gelince renk değişimi */
    transition: background-color 0.5s ease; /* Geçiş süresi ve yumuşaklık ayarı */
    
}

/* Tablo konteynerini sınırlandır ve overflow ekle */
#table-container {
    max-height: 400px; /* Tabloya belirli bir yükseklik veriyoruz */
    overflow-y: auto; /* Yatay scroll ekliyoruz */
    border: 1px solid #ccc; /* Dış sınırlar */
}

/* Tablo düzeni */
#part-details-table {
    width: 100%;
    border-collapse: collapse; /* Kenarları birleştir */
}

/* Sabit kalan başlıklar */
#part-details-table thead th {
    position: sticky;
    top: 0;
    background-color: #f9f9f9; /* Sabit başlıklar için arka plan */
    z-index: 2;
    text-align: left;
    padding: 10px;
    border-bottom: 2px solid #ddd;
    font-weight: bold;
}

/* Satır düzeni */
#part-details-table tbody td {
    padding: 8px;
    border-bottom: 1px solid #ddd;
    text-align: left;
}

/* Tabloya arka plan ve genel stil */
#part-details-table tbody tr:nth-child(even) {
    background-color: #f2f2f2;
}

/* Scroll edilen tablo için sütunların genişliğini belirle */
#part-details-table th, #part-details-table td {
    min-width: 150px; /* Kolonların minimum genişliği */
}


.details-content {
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    flex-direction: row;
    flex-wrap: wrap;
}

.api-column {
    text-align: center;
    width: 18%; /* Her sütunun genişliği */
    padding: 10px;
}

.api-logo {
    width: 100px; /* Logonun genişliği */
    height: auto; /* Yükseklik otomatik */
    margin-bottom: 10px;
}

.api-column p {
    margin: 5px 0;
}

    </style>
</head>
<body>
    <div id="container">
        <!-- Sol Menü -->
         <div class="leftSide">
        <div id="logo">
            <div class="logoImage"><img src="/images/logo.png" alt="Logo" id="logo-img"></div>

            <div id="logoBigText">
                <span id="logoText">SUPPLERA</span>
                <span id="logoTextUnder">Risk Free Your Chain</span>
            </div>
            
        </div>
        <div id="sidebar">
            <a href="/dashboard">BOM Ekle</a>
            <a href="#">Risk Özeti</a>
            <a href="#">Ürünler</a>
            <a href="#">BOM Listeleri</a>
            <a href="#">Ayrıntılı Raporlar</a>
            <a href="#">Rapor Ayarları</a>
            <a href="#">İş Oluşturma</a>
            <a href="#">Tedarikçi Analizleri</a>
            <a href="#">Takvim</a>
        </div>
         </div>
        <!-- Sağ İçerik Alanı -->
        <div id="content">
            <!-- Select Option Alanı -->
            <div id="select-container">
                <form id="bom-form" action="/dashboard2" method="GET">
                    <select name="fileId" id="bom-selector" onchange="this.form.submit()">
                        <option value="">Bir BOM dosyası seçin</option>
                        <% bomFiles.forEach(function(bom) { %>
                            <option value="<%= bom.id %>" <%= bom.id == selectedFileId ? 'selected' : '' %> >
                                <%= bom.file_name %>
                            </option>
                        <% }) %>
                    </select>
                    
                </form>
            </div>
        
            <!-- Tablo Alanı -->
            <div id="table-container">
                <table id="part-details-table">
                    <thead>
                        <tr>
                            <th>Üretici Parça Numarası</th>
                            <th>Üretici</th>
                            <th>Adet</th>
                            <th>Stok</th>
                            <th>Birim Fiyat</th>
                            <th>Toplam</th>
                            <th>Önerilen Tedarikçi</th>
                        </tr>
                    </thead>
                    <tbody id="part-details-body">
                        <% if (bomDetails && bomDetails.length > 0) { %>
                            <% bomDetails.forEach(function(detail, index) { %>
                                <tr class="productRow" data-index="<%= index %>" data-part-number="<%= detail.partNumber %>">
                                    <td><%= detail.partNumber %></td>
                                    <td><%= detail.manufacturer || 'Bilinmiyor' %></td>
                                    <td><%= detail.quantity || 'Bilinmiyor' %></td>
                                    <td><%= detail.stock || 'N/A' %></td>
                                    <td>$<%= detail.unitPrice || 'N/A' %></td>
                                    <td>$<%= detail.totalPrice || 'N/A' %></td>
                                    <td><%= detail.recommendedSupplier || 'N/A' %></td>
                                </tr>
                    
                                <!-- Her part numarası için gizlenmiş div alanı -->
                                <tr id="details-<%= index %>" style="display: none;">
                                    <td colspan="7">
                                        <div class="details-content" id="detail-container-<%= index %>">
                                            <!-- DigiKey Bilgileri -->
                                            <div class="api-column">
                                                <img src="/images/digikey.png" alt="DigiKey" class="api-logo">
                                                <p>Parça Numarası: <%= detail.partNumber %></p>
                                                <p>Stok: <%= detail.stock %></p>
                                                <p>Fiyat: $<%= detail.unitPrice %></p>
                                                <p><a href="#" target="_blank">Detaylar</a></p>
                                            </div>
                                            
                                            <!-- Mouser Bilgileri -->
                                            <div class="api-column">
                                                <img src="/images/mouser.jpg" alt="Mouser" class="api-logo">
                                                <p>Parça Numarası: <%= detail.partNumber %></p>
                                                <p>Stok: N/A</p> <!-- Bu Mouser'dan gelecek -->
                                                <p>Fiyat: N/A</p> <!-- Bu Mouser'dan gelecek -->
                                                <p><a href="#" target="_blank">Detaylar</a></p>
                                            </div>

                                            <!-- avnet Bilgileri -->
                                            <div class="api-column">
                                                <img src="/images/Avnet.png" alt="Avnet" class="api-logo">
                                                <p>Parça Numarası: <%= detail.partNumber %></p>
                                                <p>Stok: N/A</p> <!-- Bu Mouser'dan gelecek -->
                                                <p>Fiyat: N/A</p> <!-- Bu Mouser'dan gelecek -->
                                                <p><a href="#" target="_blank">Detaylar</a></p>
                                            </div>

                                            <!-- future Bilgileri -->
                                            <div class="api-column">
                                                <img src="/images/future.jpeg" alt="future" class="api-logo">
                                                <p>Parça Numarası: <%= detail.partNumber %></p>
                                                <p>Stok: N/A</p> <!-- Bu Mouser'dan gelecek -->
                                                <p>Fiyat: N/A</p> <!-- Bu Mouser'dan gelecek -->
                                                <p><a href="#" target="_blank">Detaylar</a></p>
                                            </div>

                                            <!-- utmel Bilgileri -->
                                            <div class="api-column">
                                                <img src="/images/utmel.png" alt="utmel" class="api-logo">
                                                <p>Parça Numarası: <%= detail.partNumber %></p>
                                                <p>Stok: N/A</p> <!-- Bu Mouser'dan gelecek -->
                                                <p>Fiyat: N/A</p> <!-- Bu Mouser'dan gelecek -->
                                                <p><a href="#" target="_blank">Detaylar</a></p>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="7">Bu dosya için veri bulunamadı.</td>
                            </tr>
                        <% } %>
                    </tbody>
                    
                    
                </table>
            </div>
        </div>
        
    </div>
</body>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const productRows = document.querySelectorAll('.productRow');
    let openIndex = null;

    productRows.forEach((row, index) => {
        row.addEventListener('click', function () {
            const detailsRow = document.getElementById(`details-${index}`);
            
            // Başka bir satır açıksa önce onu kapatıyoruz
            if (openIndex !== null && openIndex !== index) {
                document.getElementById(`details-${openIndex}`).style.display = 'none';
            }

            // Eğer tıklanan satır açıksa kapat, değilse aç
            if (detailsRow.style.display === 'none' || detailsRow.style.display === '') {
                detailsRow.style.display = 'table-row';
                openIndex = index;
            } else {
                detailsRow.style.display = 'none';
                openIndex = null;
            }
        });
    });
});


    document.getElementById('bom-selector').addEventListener('change', function() {
        const fileId = this.value;
        if (fileId) {
            window.location.href = `/dashboard2/${fileId}`; // Seçilen BOM dosyasına göre sayfayı yönlendiriyoruz
        }
    });

    document.getElementsByClassName('productRow').addEventListener('click',function(){
        console.log("row a tıkladı");

        // productRow sınıfına sahip her bir elemana tıklama olayını ekle
const productRows = document.getElementsByClassName('productRow');
let openIndex = null;  // Şu anda hangi satırın açık olduğunu takip etmek için

// HTMLCollection olan productRows'u array'e çevirip foreach ile döngü kuralım
Array.from(productRows).forEach((row, index) => {
    row.addEventListener('click', function () {
        const partNumber = row.getAttribute('data-part-number');
        const detailsRow = document.getElementById(`details-${index}`);

        // Eğer başka bir satır açık ise onu kapat
        if (openIndex !== null && openIndex !== index) {
            document.getElementById(`details-${openIndex}`).style.display = 'none';
        }

        // Eğer detay satırı kapalıysa aç ve içeriği doldur
        if (detailsRow.style.display === 'none' || detailsRow.style.display === '') {
            detailsRow.innerHTML = `
                <td colspan="7">
                    <div class="details-content">
                        <div class="api-column">
                            <img src="/images/digikey-logo.png" alt="DigiKey" class="api-logo">
                            <p>Parça Numarası: ${partNumber}</p>
                            <p>Stok: 100</p>
                            <p>Fiyat: $10.00</p>
                            <p><a href="#">Detaylar</a></p>
                        </div>
                        <div class="api-column">
                            <img src="/images/mouser-logo.png" alt="Mouser" class="api-logo">
                            <p>Parça Numarası: ${partNumber}</p>
                            <p>Stok: 50</p>
                            <p>Fiyat: $15.00</p>
                            <p><a href="#">Detaylar</a></p>
                        </div>
                        <!-- Diğer API'ler için sütunlar ekleyebilirsin -->
                    </div>
                </td>
            `;
            detailsRow.style.display = 'table-row';  // Detay satırını göster
            openIndex = index;  // Açık olan satırı güncelle
        } else {
            detailsRow.style.display = 'none';  // Eğer zaten açık ise kapat
            openIndex = null;
        }
    });
});



    });
    

function populatePartDetails(data) {
    const container = document.getElementById('part-details-body');
    container.innerHTML = ''; // Temizle

    if (data.partDetails && data.partDetails.length > 0) {
        data.partDetails.forEach((detail, index) => {
            const row = document.createElement('tr');
            row.classList.add('part-row');  // Satırları part-row sınıfıyla işaretle
            row.setAttribute('data-part-number', detail.partNumber);  // Part numarasını veri olarak ekliyoruz
            row.setAttribute('data-index', index);  // Index bilgisini ekliyoruz

            row.innerHTML = `
                <td>${detail.partNumber}</td>
                <td>${detail.manufacturer || 'Bilinmiyor'}</td>
                <td>${detail.quantity || 'Bilinmiyor'}</td>
                <td>${detail.stock || 'N/A'}</td>
                <td>$${detail.unitPrice || 'N/A'}</td>
                <td>$${detail.totalPrice || 'N/A'}</td>
                <td>${detail.recommendedSupplier || 'N/A'}</td>
            `;

            // Detay satırı
            const detailsRow = document.createElement('tr');
            detailsRow.id = `details-${index}`;
            detailsRow.style.display = 'none'; // Başlangıçta gizli olacak
            detailsRow.innerHTML = `<td colspan="7"></td>`;  // Detaylar buraya eklenecek

            container.appendChild(row);
            container.appendChild(detailsRow);  // Detay satırını ekliyoruz
        });

        addRowClickListeners(); // Satır tıklama olaylarını ekle
    } else {
        container.innerHTML = '<tr><td colspan="7">Bu dosya için part numarası bulunamadı.</td></tr>';
    }
}

    function addRowClickListeners() {
        console.log("addRowClickListeners a girdi");
    const partRows = document.querySelectorAll('.part-row');
    let openIndex = null;

    partRows.forEach(row => {
        row.addEventListener('click', async function () {
            console.log("Satıra tıklandı: ", this.getAttribute('data-part-number'));
            const partNumber = this.getAttribute('data-part-number');
            const index = this.getAttribute('data-index');
            const detailsRow = document.getElementById(`details-${index}`);

            if (openIndex !== null && openIndex !== index) {
                document.getElementById(`details-${openIndex}`).style.display = 'none';  // Önceki açık satırı kapat
            }

            if (detailsRow.style.display === 'none' || detailsRow.style.display === '') {
                const digikeyData = await fetch(`/api/digikey/${partNumber}`).then(res => res.json());
                const mouserData = await fetch(`/api/mouser/${partNumber}`).then(res => res.json());

                const api3Data = { partNumber: partNumber, stock: "N/A", unitPrice: "N/A", productUrl: "#" };
                const api4Data = { partNumber: partNumber, stock: "N/A", unitPrice: "N/A", productUrl: "#" };
                const api5Data = { partNumber: partNumber, stock: "N/A", unitPrice: "N/A", productUrl: "#" };

                detailsRow.innerHTML = `
                    <td colspan="7">
                        <div class="details-content">
                            <div class="api-column">
                                <img src="/images/digikey-logo.png" alt="DigiKey" class="api-logo">
                                <p>Parça Numarası: ${digikeyData.partNumber}</p>
                                <p>Stok: ${digikeyData.stock}</p>
                                <p>Fiyat: ${digikeyData.unitPrice}</p>
                                <p><a href="${digikeyData.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                            <div class="api-column">
                                <img src="/images/mouser-logo.png" alt="Mouser" class="api-logo">
                                <p>Parça Numarası: ${mouserData.partNumber}</p>
                                <p>Stok: ${mouserData.stock}</p>
                                <p>Fiyat: ${mouserData.unitPrice}</p>
                                <p><a href="${mouserData.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                            <div class="api-column">
                                <img src="/images/api3-logo.png" alt="API 3" class="api-logo">
                                <p>Parça Numarası: ${api3Data.partNumber}</p>
                                <p>Stok: ${api3Data.stock}</p>
                                <p>Fiyat: ${api3Data.unitPrice}</p>
                                <p><a href="${api3Data.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                            <div class="api-column">
                                <img src="/images/api4-logo.png" alt="API 4" class="api-logo">
                                <p>Parça Numarası: ${api4Data.partNumber}</p>
                                <p>Stok: ${api4Data.stock}</p>
                                <p>Fiyat: ${api4Data.unitPrice}</p>
                                <p><a href="${api4Data.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                            <div class="api-column">
                                <img src="/images/api5-logo.png" alt="API 5" class="api-logo">
                                <p>Parça Numarası: ${api5Data.partNumber}</p>
                                <p>Stok: ${api5Data.stock}</p>
                                <p>Fiyat: ${api5Data.unitPrice}</p>
                                <p><a href="${api5Data.productUrl}" target="_blank">Detaylar</a></p>
                            </div>
                        </div>
                    </td>
                `;

                detailsRow.style.display = 'table-row';
                openIndex = index;
            } else {
                detailsRow.style.display = 'none';
                openIndex = null;
            }
        });
    });
}

</script>


</html>
